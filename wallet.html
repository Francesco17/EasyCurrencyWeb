<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="css/style.css">
<script type="text/javascript" src="js/user.js"></script>
<script type="text/javascript" src="js/exchange.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<head>
<title>Analisi Finanziaria</title>
</head>
<body>

  <div class="container">

    <div class="nav">
      <ul>
        <li class="logo"><a href="#">PROGETTO</a></li>
        <li class="home"><a href="index.html">Home</a></li>
        <li class="currencies-page"><a href="realtime_curr.html">Currencies</a></li>
        <li class="wallet-page"><a class="active" href="wallet.html">Wallet</a></li>
        <li class="contacts"><a href="contacts.html">Contacts</a></li>
        <li class="about"><a href="aboutus.html">About us</a></li>
      </ul>
    </div>

    <div class="box1" style="height:50px; padding: 10px; display: none;" id="not_logged">
      <div class="content" id="content">
        <p>
          Se vuoi accedere alla funzionalità portafoglio devi effettuare il login..
        </p>
      </div>
    </div>

    <!-- aggiungo uno spazio tra i 2 div -->
    <div>
      &nbsp;
    </div>
    <!-- primo box contenente le informazioni dell'utente-->
    <div class="box1" id="box_logged">
      <div class="content" id="content">
        <h1>Portafoglio</h1>
        <h3>Nome Utente: <script type="text/javascript">document.write(Object.keys(sessionStorage).toString());</script></h3>
        <h3>Deposito:

          <script type="text/javascript">
            var username = Object.keys(sessionStorage).toString();
            _user = JSON.parse(sessionStorage.getItem(username));
            if (sessionStorage.length == 1) {
              var deposit = compute_deposit(_user);
              document.write(deposit);
              // document.write(_user.balance[_user.balance.length -1]);
              show_transactions(_user);
            }
          </script>
        </h3>
        <h3>Saldo:
          <!-- <script type="text/javascript">
            // TO DOOOOO
          </script> -->
        </h3>
        <p>
          Scegli la tua valuta principale:
        </p>
        <select class="currencies" id="curr_1_wall">
          <!-- carico le options e seleziono il valore di default -->
          <script type="text/javascript">
            $("#curr_1_wall").load("files/currencies.html", function(){
              $("#curr_1_wall").val("USD");
            });
          </script>
        </select>
      </div>
    </div>

    <div>
      &nbsp;
    </div>

    <div class="box1" id="box_change" style="height:auto; padding: 10px; display: none;">
      <div class="content" id="content">
        Quanti soldi convertire?
        <input type="text" name="amount" id="amount" required/>
        Seleziona la valuta:
        <select class="currencies" id="curr_2_wall">
          <!-- carico le options e seleziono il valore di default -->
          <script type="text/javascript">
          $("#curr_2_wall").load("files/currencies.html");
          </script>
        </select>
        Effettua il cambio:
        <button style="height:30px;width:100px" value="cambio" id="change">Cambio</button>
      </div>
    </div>

    <script type="text/javascript">
      $("#change").click(function(){

        var username = Object.keys(sessionStorage).toString();
        // devo prendere value, currency e rate
        var value = document.getElementById("amount").value;
        var currency = $("#curr_2_wall").val();

        var from = $("#curr_1_wall").val();
        var rate;
        currencyconverter(from, currency, value, function(output){
          // prelevo il tasso di cambio
          rate = compute_rate(from, currency, value, output);
          // metto la transazione nello storage quando ho ricevuto i dati tramite callback
          trans(username, value, currency, rate);
          // $("#box_change").fadeOut();
        });

      });
    </script>

    <!-- aggiungo uno spazio tra i 2 div -->
    <div>
      &nbsp;
    </div>
    <div class="box1" id="add_change" style="height:auto; padding: 10px">
      <div class="content" id="content">
        <p>
          Se vuoi effettuare un cambio clicca sul bottone..
          <button style="height:30px;width:100px" value="aggiungi" id="add">Aggiungi</button>
          <button style="height:30px;width:100px" value="cambio" id="cancel_change">Annulla</button>
        </p>
      </div>
    </div>

    <script type="text/javascript">
      $("#cancel_change").hide();
      $("#add").click(function (){
        $("#box_change").fadeIn();
        $("#cancel_change").show();
      });
      $("#cancel_change").click(function(){
        $("#box_change").fadeOut();
        $("#cancel_change").fadeOut();
      });
    </script>

    <script type="text/javascript">
    // se l'utente non è loggato, non accede alla feature portafoglio.
       if (sessionStorage.length != 1) {
         // faccio il display di un messaggio di errore
         $("#not_logged").show();
         $("#box_logged").hide();
         $("#add_change").hide();
       }
       else {
         $("#not_logged").hide();
       }
    </script>

  </div>

    </body>

</html>
