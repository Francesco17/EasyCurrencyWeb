<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="css/style.css">
<script type="text/javascript" src="js/user.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<script type="text/javascript" src="js/cambistorici.js"></script>
<script src="js/plotly-latest.min.js"></script>


<head>
<title>Beccate sto graficazzo!</title>
</head>
<body>

  <div class="container">

    <!-- secondo box contenente l'interfaccia per la registrazione, inizialmente nascosto -->
    <div class="box1" id="box_reg" style="display: none">
      <div class="content" id="content" >

        <div id="registration">
          <h2>Completa il form per registrarti al sito.</h2>
          <!-- al click chiama la funzione registration() -->
          <form name="myform_reg" id="form_reg" onsubmit="registration(); return false;">
            Username:<br />
            <input type="text" name="username" id="uname" required><br />
            Password:<br />
            <input type="password" name="password" id="passw" required><br />
            <p></p>
            <input type="submit" value="Registrami">
            <!-- al click chiama la funzione hide_reg -->
            <input type="submit" value="Annulla" onclick="hide_reg(); return false;"></button>
          </form>
        </div>

      </div>
    </div>

    <!-- box contentente il convertitore di valute, l'altezza è fissata -->
    <div class="box1" style="height: 300px">
      <div class="content" id="content">
          <h2>Converti Valute</h2>
          <p>Strumento semplice per convertire le valute, nei principali cambi</p>
          <div class="flex-container">
            <div>
              <!-- organizzo il contenuto in una tabella -->
              <table class="table1">
                <tr>
                  <td>
                    Seleziona una valuta:
                  </td>
                </tr>
                <tr>
                  <td>
                    <select class="currencies" id="curr_1">
                      <!-- carico le options e seleziono il valore di default -->
                      <script type="text/javascript">
                      $("#curr_1").load("files/currencies.html", function(){
                        $("#curr_1").val("USD");
                      });
                      </script>
                    </select>
                  </td>
                </tr>
                <div>
                  &nbsp;
                </div>
                <tr>
                  <td>
                    <input type="text" id="val1" name="val1" size="19"/>
                  </td>
                </tr>
              </table>
            </div>
            <div>
              <table class="table1">
                <tr>
                  <td>
                    Seleziona una valuta:
                  </td>
                </tr>
                <tr>
                  <td>
                    <select class="currencies" id="curr_2">
                      <script type="text/javascript">
                      $("#curr_2").load("files/currencies.html", function(){
                        $("#curr_2").val("EUR");
                      });
                      </script>
                    </select>
                  </td>
                </tr>
                <div>
                  &nbsp;
                </div>
                <tr>
                  <td>
                    <input type="text" id="val2" name="val2" size="19"/>
                  </td>
                </tr>
              </table>
            </div>
            <div style="background: inherit;">
              <input id="converti" type="submit" value="Converti" />

            </div>
          </div>
      </div>
    </div>

    <div>
		da quale data?<br />
      <input id="giorno" type="date"  value="2017-01-01" min="2010-01-01"/><br />
    quanti input sulle ascisse<br />
      <input id="ascisse" type="number" value="4" min="2" max="31"/><br />
      e con quale passo?<br />
      <input id="passo" type="number"  value="1" min="1" /><br />
      <button id="grafico">Grafico</button>

    </div>

    <script type="text/javascript">

      $("#converti").click(function(){

        var from = $("#curr_1").val();
        var to = $("#curr_2").val();
        var val1 = document.getElementById('val1').value;
        var date = document.getElementById("giorno").value;

        console.log("cliccato");
        currency_graph(from, to, val1, date, function(risultato){
          console.log(risultato);
          document.getElementById("val2").value = risultato;
        })
      });

    </script>

	<div id="GraficoStoricoValuta" style="width:830px;height:450px;"></div>
	<script>

	// max date uguale ad oggi
		var today = new Date();
		var dd = today.getDate();
		var mm = today.getMonth()+1; //zero è gennaio
		var yyyy = today.getFullYear();
		if(dd<10) {dd='0'+dd}
		if(mm<10) {mm='0'+mm}
		today = yyyy+'-'+mm+'-'+dd;
		document.getElementById("giorno").setAttribute("max", today);



$("#grafico").click(function (){

  var from = $("#curr_1").val();
  var to = $("#curr_2").val();
  var val1 = document.getElementById('val1').value;

  var ascisse = Number($("#ascisse").val());
  console.log("num ascisse --> "+ascisse);
  var passo = Number($("#passo").val());
  // console.log("num passo --> "+passo);

  var dateAsseX = [];
  var valoriAsseY = [];

  const millgiorno = 86400000;  // millisecondi in un giorno
  var date = new Date(document.getElementById("giorno").value);
  date_mill = date.getTime();

  // console.log("init del date mill "+date_mill);
  dateAsseX[0] = document.getElementById("giorno").value;


  for (let i = 0; i < ascisse; i++) {
    date_mill += millgiorno*passo;
    date = new Date(date_mill);
    dateAsseX[i] = date.toISOString();
    dateAsseX[i] = dateAsseX[i].substring(NaN,10);
    // chiamata bloccante
    valoriAsseY[i] = currency_graph(from, to, 1, dateAsseX[i]);
    // chiamata non bloccante
    // currency_graph(from, to, 1, dateAsseX[i], function(val2){
    //   valoriAsseY[i] = val2;
    //   // console.log("valore asse Y: "+valoriAsseY[i]+" in posizione "+i);
    // });
  }

  // console.log(dateAsseX);
  // console.log(valoriAsseY);

  // var stampaAsseXX = ['2013-10-04 22:23:00', '2013-11-04 22:23:00', '2013-12-04 22:23:00'];
  // var valoriAsseYY = [1, 3, 6];

  var data = [
    {
      x: dateAsseX,
      y: valoriAsseY,
      type: 'scatter'
    }
    ];

    Plotly.newPlot('GraficoStoricoValuta', data);
});

// 		var temp=Date(inizio);
// 		stampaAsseX[0]=temp;
// 		console.log(stampaAsseX[0]);
// //		dateAsseX[0]=temp.getTime();
// 		valoriAsseY[0]=inizioval;
// 		console.log(inizioval);




	</script>
      	</div>


    </div>

    </body>
</html>
